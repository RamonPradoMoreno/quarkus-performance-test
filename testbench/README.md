# Testing our containers

Once we have all the system running we can monitor the containers in a idle state but we want to also how they behave under a certain load.

## Throwing single requests

To call `native` and `jvm` services we can use:

```bash
curl http://localhost:8090/hello -v
curl http://localhost:8091/hello -v
```

To call `wildfly` service we can use:

```bash
curl http://localhost:8092/rest-hello-0.0.1/resources/hello -v
```

## Throwing load tests

We will be using [Apache Bench](https://www.petefreitag.com/item/689.cfm).

Install it with:

```bash
sudo dnf install httpd-tools
```

We can create a bash script to do this tests:

```bash
#!/bin/sh
# -t indicates the time that it will be sending requests.
# -c indicates the concurrency, in this case 10 threads at the same time sending data.
ab -t 120 -c 10 http://localhost:8090/hello > native.txt &
ab -t 120 -c 10 http://localhost:8091/hello > jvm.txt &
ab -t 120 -c 10 http://localhost:8092/rest-hello-0.0.1/resources/hello > wildfly.txt &
```

## Results

Here we can see the performance of each container for a two minute test in my machine. All this info has been extracted from the `.txt` files generated by our test script.

### General info

| Container | Concurrency Level | Time taken for test (s) | Complete requests | Requests/second mean | Time taken per request (ms) mean |
| --------- | ----------------- | ----------------------- | ----------------- | -------------------- | -------------------------------- |
| Wildfly   | 10                | 120.000                 | 36738             | 297.49               | 33.614                           |
| JVM       | 10                | 118.529                 | 50047             | 421.84               | 23.706                           |
| Native    | 10                | 109.635                 | 50051             | 456.06               | 21.927                           |

### Connection times (ms)

| Wildfly    | min  | mean | [+/- sd] | median | max   |
| ---------- | ---- | ---- | -------- | ------ | ----- |
| Connect    | 0    | 1    | 1.4      | 0      | 55    |
| Processing | 1    | 33   | 29.7     | 25     | 467   |
| Waiting    | 0    | 28   | 26.8     | 20     | 369   |
| Total      | 1    | 33   | 29.8     | 26     | *467* |

| JVM        | min  | mean | [+/- sd] | median | max   |
| ---------- | ---- | ---- | -------- | ------ | ----- |
| Connect    | 0    | 1    | 1.7      | 0      | 41    |
| Processing | 1    | 23   | 17.5     | 18     | 291   |
| Waiting    | 0    | 22   | 17.0     | 18     | 290   |
| Total      | 1    | 24   | 17.5     | 19     | *292* |

| Native     | min  | mean | [+/- sd] | median | max   |
| ---------- | ---- | ---- | -------- | ------ | ----- |
| Connect    | 0    | 1    | 2.0      | 0      | 59    |
| Processing | 1    | 21   | 11.4     | 20     | 332   |
| Waiting    | 0    | 20   | 11.0     | 19     | 332   |
| Total      | 1    | 22   | 11.5     | 20     | *333* |

### Percentage of the requests served within a certain time in ms

| percentage of requests | Wildfly | JVM    | Native |
| ---------------------- | ------- | ------ | ------ |
| 50%                    | 26      | 19     | 20     |
| 66%                    | 36      | 23     | 24     |
| 75%                    | 44      | 28     | 27     |
| 80%                    | 49      | 31     | 29     |
| 90%                    | **69**  | **44** | **35** |
| 95%                    | 90      | 56     | 41     |
| 98%                    | 120     | 73     | 49     |
| 99%                    | 147     | 90     | 58     |
| 100%                   | *467*   | *292*  | *333*  |

